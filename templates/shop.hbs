<div class="marketplace-filter" id="marketplaceActorDropzone">
    <h1 class="Shopping">{{localize "SR5.Marketplace.ShoppingBasket"}}</h1>
    <label for="item-type-selector">{{localize "SR5.Marketplace.SelectItemType"}}:</label>
    <select id="item-type-selector" class="item-type-selector">
        {{#each itemsByType as |items type|}}
            {{#if items.length}}
                {{#ifeq type "rangedWeapons"}}
                    <option value="rangedWeapons">{{localize "SR5.Marketplace.ItemTypes.RangedWeapons"}}</option>
                {{/ifeq}}
                {{#ifeq type "meleeWeapons"}}
                    <option value="meleeWeapons">{{localize "SR5.Marketplace.ItemTypes.MeleeWeapons"}}</option>
                {{/ifeq}}
                {{#ifeq type "modifications"}}
                    <option value="modifications">{{localize "SR5.Marketplace.ItemTypes.Modifications"}}</option>
                {{/ifeq}}
                {{#ifeq type "armor"}}
                    <option value="armor">{{localize "SR5.Marketplace.ItemTypes.Armor"}}</option>
                {{/ifeq}}
                {{#ifeq type "bioware"}}
                    <option value="bioware">{{localize "SR5.Marketplace.ItemTypes.Bioware"}}</option>
                {{/ifeq}}
                {{#ifeq type "cyberware"}}
                    <option value="cyberware">{{localize "SR5.Marketplace.ItemTypes.Cyberware"}}</option>
                {{/ifeq}}
                {{#ifeq type "devices"}}
                    <option value="devices">{{localize "SR5.Marketplace.ItemTypes.Devices"}}</option>
                {{/ifeq}}
                {{#ifeq type "ammo"}}
                    <option value="ammo">{{localize "SR5.Marketplace.ItemTypes.Ammo"}}</option>
                {{/ifeq}}
                {{#ifeq type "equipment"}}
                    <option value="equipment">{{localize "SR5.Marketplace.ItemTypes.Equipment"}}</option>
                {{/ifeq}}
                {{#ifeq type "lifestyles"}}
                    <option value="lifestyles">{{localize "SR5.Marketplace.ItemTypes.Lifestyles"}}</option>
                {{/ifeq}}
                {{#ifeq type "programs"}}
                    <option value="programs">{{localize "SR5.Marketplace.ItemTypes.Programs"}}</option>
                {{/ifeq}}
                {{#ifeq type "rituals"}}
                    <option value="rituals">{{localize "SR5.Marketplace.ItemTypes.Rituals"}}</option>
                {{/ifeq}}
                {{#ifeq type "sins"}}
                    <option value="sins">{{localize "SR5.Marketplace.ItemTypes.SINs"}}</option>
                {{/ifeq}}
                {{#ifeq type "spells"}}
                    <option value="spells">{{localize "SR5.Marketplace.ItemTypes.Spells"}}</option>
                {{/ifeq}}
                {{#ifeq type "actions"}}
                    <option value="actions">{{localize "SR5.Marketplace.ItemTypes.Actions"}}</option>
                {{/ifeq}}
                {{#ifeq type "qualitys"}}
                    <option value="qualitys">{{localize "SR5.Marketplace.ItemTypes.Qualitys"}}</option>
                {{/ifeq}}
                {{#ifeq type "complexForms"}}
                    <option value="complexForms">{{localize "SR5.Marketplace.ItemTypes.ComplexForms"}}</option>
                {{/ifeq}}
            {{/if}}
        {{/each}}
    </select>
    <label for="search-box">{{localize "SR5.Marketplace.Search"}}:</label>
    <input type="text" id="search-box" placeholder='{{localize "SR5.Marketplace.Search items..."}}' class="marketplace-search">
    <!-- New actor selection and connection boxes -->
    <!-- Shop Actor Drop Zone -->
    <div class="sr5-marketplace SR5ShopActor-box" id="shopActorDropzone">
        {{#if shopActorBox.shopId}}
            <a data-entity-link="Actor" data-uuid="{{shopActorBox.shopUuid}}">
                <img src="{{shopActorBox.shopImg}}" alt="{{shopActorBox.shopName}}" class="actor-icon">
            </a>
            {{#if isGM}}
                <span class="remove-link" title="Remove Shop Actor" data-shop-id="{{shopActorBox.shopId}}">&times;</span>
            {{/if}}
        {{/if}}
    </div>

    <!-- Connection Item Drop Zone -->
    <div class="sr5-marketplace SR5ConnectionLink-box" id="connectionItemDropzone">
        {{#if connectionBox}}
            <a data-entity-link="Item" data-uuid="{{connectionBox.connectionUuid}}">
                <img src="{{connectionBox.connectionImg}}" alt="{{connectionBox.connectionName}}" class="item-icon">
            </a>
            <span class="remove-link" title="Remove Connection Item" data-item-id="{{connectionBox.connectionId}}">&times;</span>
        {{/if}}
    </div>

    <!-- Selected Actor Drop Zone -->
    {{#if selectedActorBox.actorId}}
        <div class="sr5-marketplace SR5ActorSelected-box" id="{{selectedActorBox.actorId}}">
            <a data-entity-link="Actor" data-uuid="{{selectedActorBox.actorUuid}}">
                <img src="{{selectedActorBox.actorImg}}" alt="{{selectedActorBox.actorName}}" class="actor-icon">
            </a>
            {{#if isGM}}
                <span class="remove-link" title="Remove Selected Actor" data-actor-id="{{selectedActorBox.actorId}}">&times;</span>
            {{/if}}
        </div>
    {{/if}}
</div>

<div class="grid-container">
    <div id="marketplace-items" class="marketplace-items">
        {{> 'modules/sr5-marketplace/templates/libraryItem.hbs' }}
    </div>
    <div class="basket-toggle-bar">
        <div class="circle">
            <i class="fas fa-shopping-basket"></i>
            <div class="basket-count hidden">0</div>
        </div>
    </div>
    <div class="basket-content hidden">
        <h3>{{localize "SR5.Marketplace.ShoppingBasket"}}</h3>
        <div id="basket-items" class="SR5-marketplace grid-basket">
            {{> 'modules/sr5-marketplace/templates/basket.hbs' }}
        </div>
    </div>   
</div>